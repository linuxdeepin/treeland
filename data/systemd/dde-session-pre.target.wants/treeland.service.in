[Unit]
Description=TreeLand session service
StartLimitBurst=60
CollectMode=inactive-or-failed

Requires=treeland-sd.socket
PartOf=treeland-sd.socket
After=treeland-sd.socket

Requires=treeland-sd.service
PartOf=treeland-sd.service
Before=treeland-sd.service

Requires=treeland-xwayland.service
PartOf=treeland-xwayland.service
Before=treeland-xwayland.service

Requires=treeland-shortcut.service
PartOf=treeland-shortcut.service
Before=treeland-shortcut.service

Requisite=dde-session-pre.target
PartOf=dde-session-pre.target
Before=dde-session-pre.target

[Service]
ExecCondition=/bin/sh -c 'test "$XDG_SESSION_DESKTOP" = "treeland-user" || exit 2'
Type=dbus
BusName=org.deepin.Compositor1
UnsetEnvironment=DISPLAY
UnsetEnvironment=WAYLAND_DISPLAY
ExecStart=@CMAKE_INSTALL_FULL_BINDIR@/treeland
ExecStartPost=-/usr/bin/systemctl --user set-environment DDE_CURRENT_COMPOSITOR=TreeLand
ExecStop=-/usr/bin/systemctl --user unset-environment DDE_CURRENT_COMPOSITOR
Slice=session.slice
Restart=on-failure
RestartSec=1s

